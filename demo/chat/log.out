
> imsvr@0.0.1 test /Users/angl/code/github/cutekoder/demo/chat
> NODE_ENV=test DEBUG=Chat:*,socket.io:*,socket.io-client:*,socket.io-parser,engine mocha -R spec test/*.test.js

Sun, 04 May 2014 05:18:40 GMT Chat:ServerTest [address]: ws://localhost:3000

[0m[0m
[0m  Chat Server[0m
Sun, 04 May 2014 05:18:40 GMT Chat:app [handshakeData] { _readableState: 
   { highWaterMark: 16384,
     buffer: [],
     length: 0,
     pipes: null,
     pipesCount: 0,
     flowing: false,
     ended: true,
     endEmitted: false,
     reading: false,
     calledRead: true,
     sync: true,
     needReadable: false,
     emittedReadable: false,
     readableListening: false,
     objectMode: false,
     defaultEncoding: 'utf8',
     ranOut: false,
     awaitDrain: 0,
     readingMore: false,
     decoder: null,
     encoding: null },
  readable: true,
  domain: null,
  _events: {},
  _maxListeners: 10,
  socket: 
   { _connecting: false,
     _handle: null,
     _readableState: 
      { highWaterMark: 16384,
        buffer: [],
        length: 0,
        pipes: null,
        pipesCount: 0,
        flowing: false,
        ended: false,
        endEmitted: false,
        reading: true,
        calledRead: true,
        sync: false,
        needReadable: true,
        emittedReadable: false,
        readableListening: false,
        objectMode: false,
        defaultEncoding: 'utf8',
        ranOut: false,
        awaitDrain: 0,
        readingMore: false,
        decoder: null,
        encoding: null },
     readable: false,
     domain: null,
     _events: 
      { end: [Object],
        finish: [Function: onSocketFinish],
        _socketEnd: [Function: onSocketEnd],
        drain: [Function: ondrain],
        timeout: [Function],
        error: [Function],
        close: [Object],
        data: [Function: onData],
        readable: [Function] },
     _maxListeners: 10,
     _writableState: 
      { highWaterMark: 16384,
        objectMode: false,
        needDrain: false,
        ending: true,
        ended: true,
        finished: true,
        decodeStrings: false,
        defaultEncoding: 'utf8',
        length: 0,
        writing: false,
        sync: false,
        bufferProcessing: false,
        onwrite: [Function],
        writecb: null,
        writelen: 0,
        buffer: [] },
     writable: false,
     allowHalfOpen: true,
     onend: [Function],
     destroyed: true,
     errorEmitted: false,
     bytesRead: 163,
     _bytesDispatched: 321,
     _pendingData: null,
     _pendingEncoding: '',
     server: 
      { domain: null,
        _events: [Object],
        _maxListeners: 10,
        _connections: 0,
        connections: [Getter/Setter],
        _handle: [Object],
        _usingSlaves: false,
        _slaves: [],
        allowHalfOpen: true,
        httpAllowHalfOpen: false,
        timeout: 120000,
        _connectionKey: '4:0.0.0.0:3000' },
     _idleTimeout: -1,
     _idleNext: null,
     _idlePrev: null,
     _idleStart: 1399180720355,
     parser: 
      { _headers: [],
        _url: '',
        onHeaders: [Function: parserOnHeaders],
        onHeadersComplete: [Function: parserOnHeadersComplete],
        onBody: [Function: parserOnBody],
        onMessageComplete: [Function: parserOnMessageComplete],
        socket: [Circular],
        incoming: null,
        maxHeaderPairs: 2000,
        onIncoming: [Function] },
     ondata: [Function],
     pipe: [Function],
     addListener: [Function],
     on: [Function],
     pause: [Function],
     resume: [Function],
     read: [Function],
     _consuming: true,
     _httpMessage: null },
  connection: 
   { _connecting: false,
     _handle: null,
     _readableState: 
      { highWaterMark: 16384,
        buffer: [],
        length: 0,
        pipes: null,
        pipesCount: 0,
        flowing: false,
        ended: false,
        endEmitted: false,
        reading: true,
        calledRead: true,
        sync: false,
        needReadable: true,
        emittedReadable: false,
        readableListening: false,
        objectMode: false,
        defaultEncoding: 'utf8',
        ranOut: false,
        awaitDrain: 0,
        readingMore: false,
        decoder: null,
        encoding: null },
     readable: false,
     domain: null,
     _events: 
      { end: [Object],
        finish: [Function: onSocketFinish],
        _socketEnd: [Function: onSocketEnd],
        drain: [Function: ondrain],
        timeout: [Function],
        error: [Function],
        close: [Object],
        data: [Function: onData],
        readable: [Function] },
     _maxListeners: 10,
     _writableState: 
      { highWaterMark: 16384,
        objectMode: false,
        needDrain: false,
        ending: true,
        ended: true,
        finished: true,
        decodeStrings: false,
        defaultEncoding: 'utf8',
        length: 0,
        writing: false,
        sync: false,
        bufferProcessing: false,
        onwrite: [Function],
        writecb: null,
        writelen: 0,
        buffer: [] },
     writable: false,
     allowHalfOpen: true,
     onend: [Function],
     destroyed: true,
     errorEmitted: false,
     bytesRead: 163,
     _bytesDispatched: 321,
     _pendingData: null,
     _pendingEncoding: '',
     server: 
      { domain: null,
        _events: [Object],
        _maxListeners: 10,
        _connections: 0,
        connections: [Getter/Setter],
        _handle: [Object],
        _usingSlaves: false,
        _slaves: [],
        allowHalfOpen: true,
        httpAllowHalfOpen: false,
        timeout: 120000,
        _connectionKey: '4:0.0.0.0:3000' },
     _idleTimeout: -1,
     _idleNext: null,
     _idlePrev: null,
     _idleStart: 1399180720355,
     parser: 
      { _headers: [],
        _url: '',
        onHeaders: [Function: parserOnHeaders],
        onHeadersComplete: [Function: parserOnHeadersComplete],
        onBody: [Function: parserOnBody],
        onMessageComplete: [Function: parserOnMessageComplete],
        socket: [Circular],
        incoming: null,
        maxHeaderPairs: 2000,
        onIncoming: [Function] },
     ondata: [Function],
     pipe: [Function],
     addListener: [Function],
     on: [Function],
     pause: [Function],
     resume: [Function],
     read: [Function],
     _consuming: true,
     _httpMessage: null },
  httpVersion: '1.1',
  complete: false,
  headers: 
   { 'user-agent': 'node-XMLHttpRequest',
     accept: '*/*',
     host: 'localhost:3000',
     connection: 'close' },
  trailers: {},
  _pendings: [],
  _pendingIndex: 0,
  url: '/socket.io/?EIO=3&transport=polling&t=1399180720332-0&b64=1',
  method: 'GET',
  statusCode: null,
  client: 
   { _connecting: false,
     _handle: null,
     _readableState: 
      { highWaterMark: 16384,
        buffer: [],
        length: 0,
        pipes: null,
        pipesCount: 0,
        flowing: false,
        ended: false,
        endEmitted: false,
        reading: true,
        calledRead: true,
        sync: false,
        needReadable: true,
        emittedReadable: false,
        readableListening: false,
        objectMode: false,
        defaultEncoding: 'utf8',
        ranOut: false,
        awaitDrain: 0,
        readingMore: false,
        decoder: null,
        encoding: null },
     readable: false,
     domain: null,
     _events: 
      { end: [Object],
        finish: [Function: onSocketFinish],
        _socketEnd: [Function: onSocketEnd],
        drain: [Function: ondrain],
        timeout: [Function],
        error: [Function],
        close: [Object],
        data: [Function: onData],
        readable: [Function] },
     _maxListeners: 10,
     _writableState: 
      { highWaterMark: 16384,
        objectMode: false,
        needDrain: false,
        ending: true,
        ended: true,
        finished: true,
        decodeStrings: false,
        defaultEncoding: 'utf8',
        length: 0,
        writing: false,
        sync: false,
        bufferProcessing: false,
        onwrite: [Function],
        writecb: null,
        writelen: 0,
        buffer: [] },
     writable: false,
     allowHalfOpen: true,
     onend: [Function],
     destroyed: true,
     errorEmitted: false,
     bytesRead: 163,
     _bytesDispatched: 321,
     _pendingData: null,
     _pendingEncoding: '',
     server: 
      { domain: null,
        _events: [Object],
        _maxListeners: 10,
        _connections: 0,
        connections: [Getter/Setter],
        _handle: [Object],
        _usingSlaves: false,
        _slaves: [],
        allowHalfOpen: true,
        httpAllowHalfOpen: false,
        timeout: 120000,
        _connectionKey: '4:0.0.0.0:3000' },
     _idleTimeout: -1,
     _idleNext: null,
     _idlePrev: null,
     _idleStart: 1399180720355,
     parser: 
      { _headers: [],
        _url: '',
        onHeaders: [Function: parserOnHeaders],
        onHeadersComplete: [Function: parserOnHeadersComplete],
        onBody: [Function: parserOnBody],
        onMessageComplete: [Function: parserOnMessageComplete],
        socket: [Circular],
        incoming: null,
        maxHeaderPairs: 2000,
        onIncoming: [Function] },
     ondata: [Function],
     pipe: [Function],
     addListener: [Function],
     on: [Function],
     pause: [Function],
     resume: [Function],
     read: [Function],
     _consuming: true,
     _httpMessage: null },
  _consuming: true,
  _dumped: true,
  httpVersionMajor: 1,
  httpVersionMinor: 1,
  upgrade: false,
  _query: { EIO: '3', transport: 'polling', t: '1399180720332-0', b64: '1' },
  res: 
   { domain: null,
     _events: { finish: [Function] },
     _maxListeners: 10,
     output: [],
     outputEncodings: [],
     writable: true,
     _last: true,
     chunkedEncoding: false,
     shouldKeepAlive: false,
     useChunkedEncodingByDefault: true,
     sendDate: true,
     _headerSent: true,
     _header: 'HTTP/1.1 200 OK\r\nContent-Type: text/plain; charset=UTF-8\r\nContent-Length: 115\r\nAccess-Control-Allow-Origin: *\r\nSet-Cookie: io=sG2vhJDgpMwzHh5YAAAA\r\nDate: Sun, 04 May 2014 05:18:40 GMT\r\nConnection: close\r\n\r\n',
     _hasBody: true,
     _trailer: '',
     finished: true,
     _hangupClose: false,
     socket: null,
     connection: null,
     _headers: 
      { 'content-type': 'text/plain; charset=UTF-8',
        'content-length': '115',
        'access-control-allow-origin': '*',
        'set-cookie': 'io=sG2vhJDgpMwzHh5YAAAA' },
     _headerNames: 
      { 'content-type': 'Content-Type',
        'content-length': 'Content-Length',
        'access-control-allow-origin': 'Access-Control-Allow-Origin',
        'set-cookie': 'Set-Cookie' },
     _emittedHeader: true,
     statusCode: 200 },
  cleanup: [Function: cleanup],
  read: [Function] }
Sun, 04 May 2014 05:18:40 GMT Chat:app New client is connected...[socket id]:sG2vhJDgpMwzHh5YAAAA

  [32m  ✓[0m[90m should connect the server success [0m[31m(87ms)[0m


[92m [0m[32m 1 passing[0m[90m (103ms)[0m

